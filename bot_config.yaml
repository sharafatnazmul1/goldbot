# ============================================================================
# GOLDBOT - XAUUSD Breakout Trading System (FIXED CONFIG)
# ============================================================================

# --- MetaTrader5 Connection ---
mt5:
  login: 270151243           # Replace with your MT5 account number
  password: "@@Sharafatnh6@@" # Replace with your MT5 password
  server: "Exness-MT5Trial17"  # Replace with your broker server name
  timeout: 60000            # Connection timeout in ms
  path: C:\Program Files\MetaTrader 5\terminal64.exe                  # Leave empty for auto-detect

# --- Telegram Configuration ---
telegram:
  enabled: false            # Set true after testing
  bot_token: "YOUR_BOT_TOKEN_HERE"
  chat_id: "YOUR_CHAT_ID_HERE"
  send_startup: true
  send_trades: true
  send_errors: true
  send_daily_summary: true

# --- Trading Symbol ---
symbol: "XAUUSDm"
point_value: 100.0         # XAUUSD contract size: 100 troy ounces per lot

# --- Timeframes ---
timeframes:
  primary: "M5"            # Primary analysis timeframe
  confirm: "M1"            # Confirmation timeframe
  bias: "H1"               # HTF bias timeframe

# --- Risk Management (SCALPING) ---
risk:
  risk_per_trade: 0.01     # 1% risk per trade (FIXED)
  max_position_risk: 0.02  # Max 2% concurrent risk
  max_concurrent_trades: 2 # Max 2 simultaneous positions
  daily_loss_limit: 0.03   # Stop at 3% daily loss
  weekly_loss_limit: 0.06  # Stop at 6% weekly loss
  max_drawdown_limit: 0.10 # Max 10% drawdown from peak
  consecutive_loss_limit: 3 # Stop after 3 consecutive losses
  min_equity: 10.0         # Minimum $10 equity

  # Dynamic risk scaling (CORRECTED - lower for small accounts)
  dynamic_risk_tiers:
    - max_equity: 100.0
      risk_pct: 0.005      # 0.5% for accounts under $100
    - max_equity: 1000.0
      risk_pct: 0.01       # 1% for $100-$1000
    - max_equity: 5000.0
      risk_pct: 0.015      # 1.5% for $1000-$5000
    - max_equity: 9999999
      risk_pct: 0.02       # 2% max for large accounts

# --- Position Sizing ---
position:
  min_lot: 0.02            # Exness minimum lot size
  max_lot: 2.0             # Maximum lot size
  lot_step: 0.02           # Lot size increment

# --- ATR / Volatility Settings ---
atr:
  period: 14
  volatility_threshold: 0.8    # Minimum ATR in $ to allow trades
  high_threshold: 2.0          # High volatility boundary

# --- Scoring System ---
scoring:
  threshold_trade: 50     # Minimum score to enter trade
  threshold_high: 75       # High confidence threshold

  # Weights for scoring
  weights:
    session: 20
    sweep: 30
    rejection: 15
    impulse: 20
    fvg: 15
    htf_bias_aligned: 10
    htf_bias_opposed: -10
    high_volatility: 5

# --- Session Windows (UTC) ---
sessions:
  london:
    start: "07:00"
    end: "10:30"
  newyork:
    start: "13:20"
    end: "15:00"
  no_trade:
    start: "23:50"
    end: "00:10"

# --- Session Transition Buffers ---
session_buffers:
  enabled: true

  # Buffer around major session transitions (minutes)
  london_open:
    time: "08:30"              # Tokyo-London overlap starts
    buffer_minutes: 30         # 08:00-09:00 no-trade zone
    reason: "Tokyo-London overlap volatility"
  
  newyork_open:
    time: "13:00"              # London-NY overlap starts
    buffer_minutes: 30         # 12:30-13:30 no-trade zone
    reason: "London-NY overlap volatility"

# --- News Filter ---
news:
  enabled: false           # Set true after adding news API
  buffer_minutes: 30       # Minutes before/after high-impact news

# --- Spread & Filters ---
filters:
  max_spread: 0.30         # Maximum allowed spread in $

# --- Retracement Settings ---
retracement:
  shallow_min: 0.10        # 10% minimum retrace
  shallow_max: 0.40        # 40% maximum retrace
  shallow_ratio: 0.30      # Default 30% retrace entry

# --- Stop Loss & Take Profit (SCALPING) ---
stop_loss:
  buffer: 0.10             # $0.10 buffer above/below sweep wick
  minimum: 0.15            # 15 pips minimum SL (FIXED)

take_profit:
  tp1_multiplier: 1.0      # TP1 = 1.0R (FIXED)
  tp2_multiplier: 2.0      # TP2 = 2.0R (FIXED)
  partial_close_pct: 0.5   # Close 50% at TP1 (FIXED)

# --- Trade Management (SCALPING) ---
trade_management:
  breakeven_at_r: 1.0      # Move to BE after TP1 hit
  trail_at_r: 1.5          # Enable trailing at 1.5R (FIXED)
  trail_atr_mult: 1.0      # Trail distance = 1.0 * ATR
  max_hold_bars: 8         # Maximum 8 M5 bars = 40 minutes
  min_time_between_trades: 300   # 5 min between trades
  max_trades_per_session: 3      # Max 3 trades per session
  cooloff_after_loss: 600        # 10 min cooloff after loss

# --- Lookback Periods ---
lookback:
  swing: 5                 # Bars to look back for swing high/low
  avg_body: 10             # Period for average body size

# --- Entry Models ---
entry_models:
  momentum_break:
    enabled: true
    execution_type: "IOC"
    max_slippage: 0.10     # $0.10 max slippage

  shallow_retest:
    enabled: true
    execution_type: "LIMIT"
    cancel_after_bars: 3   # Cancel limit order after 3 bars

  fvg_sniper:
    enabled: false         # DISABLED until volume filter added

# --- HTF Bias Settings (DISABLED) ---
htf_bias:
  enabled: false           # Broken logic, disable for now
  ema_period: 20

# --- Impulse Settings ---
impulse:
  body_multiplier: 1.5     # Body must be 1.5x average
  volume_enabled: false    # Volume data often unreliable in MT5

# --- Operational Settings ---
operational:
  loop_sleep_seconds: 1    # Sleep time in main loop
  order_retry_attempts: 3  # Retry failed orders 3 times
  order_retry_delay: 2     # Seconds between retries
  log_level: "INFO"
  log_file: "goldbot.log"

# --- Backtest Settings ---
backtest:
  start_date: "2024-11-01"
  end_date: "2024-11-30"
  initial_balance: 100.0
  commission_per_lot: 3.50  # Exness commission ~$3.50/lot
  generate_report: true
  report_file: "backtest_report.html"

# --- Safety & Failsafes ---
safety:
  check_connection_interval: 60
  max_spread_multiplier: 2.0
  idempotency_enabled: true
  recheck_sl_tp: true
